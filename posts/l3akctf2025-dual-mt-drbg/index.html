<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>l3akctf2025 — Dual MT DRBG &#183; Home</title><meta name=title content="l3akctf2025 — Dual MT DRBG &#183; Home"><meta name=keywords content="ctf,crypto,MT19937,linear algebra,"><link rel=canonical href=https://etynso.github.io/posts/l3akctf2025-dual-mt-drbg/><meta name=author content="Etynso"><link href=https://discordapp.com/users/227017299939426304 rel=me><meta property="og:url" content="https://etynso.github.io/posts/l3akctf2025-dual-mt-drbg/"><meta property="og:site_name" content="Home"><meta property="og:title" content="l3akctf2025 — Dual MT DRBG"><meta property="og:description" content='l3akctf2025 - Dual MT DRBG # Recently i participated in l3akctf2025, and during the CTF I mainly focused on doing the cryptography challenges. I managed to solve the least-solved challenge in this category, “Dual MT DRBG”.
Source Code: # server.py from random import Random from flag import FLAG import os r1 = Random() r1.seed(os.urandom(32)) r2 = Random() r2.seed(os.urandom(32)) print("Dual Mersenne Twister Deterministic Random Bit Generator") num_words = int(input("n=")) if num_words > 100000: print("Network bandwidth doesnt grow on trees!") exit(1) L = [] for i in range(num_words): v1 = r1.getrandbits(32) v2 = r2.getrandbits(32) # break symmetry by rotating v2 L.append((v1 + (v2 ^ ((v2 >> 1) | (v2 & 1) << 31))) & 0xffffffff) print("L="+str(L)) print("Recover the states of r1 and r2 to get the flag.") print("Enter the next 624 outputs of r1:") for i in range(624): v1 = int(input("v1=")) if v1 != r1.getrandbits(32): print("Incorrect guess") exit(1) print("Now enter the next 624 outputs of r2:") for i in range(624): v2 = int(input("v2=")) if v2 != r2.getrandbits(32): print("Incorrect guess") exit(1) print("Congratulations, here is the flag:", FLAG) The core of the challenge involves two independent instances of Python’s Random, which we can refer to as r1 and r2.'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-21T00:00:00+00:00"><meta property="article:tag" content="Ctf"><meta property="article:tag" content="Crypto"><meta property="article:tag" content="MT19937"><meta property="article:tag" content="Linear Algebra"><meta property="og:image" content="https://etynso.github.io/posts/l3akctf2025-dual-mt-drbg/feature-l3ak.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://etynso.github.io/posts/l3akctf2025-dual-mt-drbg/feature-l3ak.png"><meta name=twitter:title content="l3akctf2025 — Dual MT DRBG"><meta name=twitter:description content='l3akctf2025 - Dual MT DRBG # Recently i participated in l3akctf2025, and during the CTF I mainly focused on doing the cryptography challenges. I managed to solve the least-solved challenge in this category, “Dual MT DRBG”.
Source Code: # server.py from random import Random from flag import FLAG import os r1 = Random() r1.seed(os.urandom(32)) r2 = Random() r2.seed(os.urandom(32)) print("Dual Mersenne Twister Deterministic Random Bit Generator") num_words = int(input("n=")) if num_words > 100000: print("Network bandwidth doesnt grow on trees!") exit(1) L = [] for i in range(num_words): v1 = r1.getrandbits(32) v2 = r2.getrandbits(32) # break symmetry by rotating v2 L.append((v1 + (v2 ^ ((v2 >> 1) | (v2 & 1) << 31))) & 0xffffffff) print("L="+str(L)) print("Recover the states of r1 and r2 to get the flag.") print("Enter the next 624 outputs of r1:") for i in range(624): v1 = int(input("v1=")) if v1 != r1.getrandbits(32): print("Incorrect guess") exit(1) print("Now enter the next 624 outputs of r2:") for i in range(624): v2 = int(input("v2=")) if v2 != r2.getrandbits(32): print("Incorrect guess") exit(1) print("Congratulations, here is the flag:", FLAG) The core of the challenge involves two independent instances of Python’s Random, which we can refer to as r1 and r2.'><link type=text/css rel=stylesheet href=/css/main.bundle.min.b7ce21e769d6628e6248cdb26ce615b731faad1d06a301b53f59a9fcf98335a55ab82fd0d6084fae0b9ff88a930e0b9e4be02d450c07942f5c220976795ac41e.css integrity="sha512-t84h52nWYo5iSM2ybOYVtzH6rR0GowG1P1mp/PmDNaVauC/Q1ghPrguf+IqTDgueS+AtRQwHlC9cIgl2eVrEHg=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link type=text/css rel=stylesheet href=/lib/katex/katex.min.aeed31e00db047821b2deca55b28fddf49d5a4e0351850d0aa2662b36ffa6d9f79268751965d7c331ac6d862b68ad6f403dc22ec50769d9b0cb439e967e39ca9.css integrity="sha512-ru0x4A2wR4IbLeylWyj930nVpOA1GFDQqiZis2/6bZ95JodRll18MxrG2GK2itb0A9wi7FB2nZsMtDnpZ+OcqQ=="><script defer type=text/javascript src=/js/katex.bundle.2a5e0f220f8881fb35c61f68c2335b1e7b289d5beea86db4b5062b597c5fe4d0240a5cee09cde8709e498fa9bb44eabbe19a359371f9ea1f77e649a4096a3940.js integrity="sha512-Kl4PIg+Igfs1xh9owjNbHnsonVvuqG20tQYrWXxf5NAkClzuCc3ocJ5Jj6m7ROq74Zo1k3H56h935kmkCWo5QA==" id=katex-render></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"l3akctf2025 — Dual MT DRBG","headline":"l3akctf2025 — Dual MT DRBG","abstract":"\u003ch1 class=\u0022relative group\u0022\u003el3akctf2025 - Dual MT DRBG\n    \u003cdiv id=\u0022l3akctf2025---dual-mt-drbg\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#l3akctf2025---dual-mt-drbg\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h1\u003e\n\u003cp\u003eRecently i participated in l3akctf2025, and during the CTF I mainly focused on doing the cryptography challenges. I managed to solve the least-solved challenge in this category, \u0026ldquo;Dual MT DRBG\u0026rdquo;.\u003c\/p\u003e\n\u003chr\u003e\n\n\u003ch2 class=\u0022relative group\u0022\u003eSource Code:\n    \u003cdiv id=\u0022source-code\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#source-code\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\n\u003cdetails\u003e\n  \u003csummary\u003eserver.py\u003c\/summary\u003e\n  \u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 class=\u0022chroma\u0022\u003e\u003ccode class=\u0022language-python\u0022 data-lang=\u0022python\u0022\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022kn\u0022\u003efrom\u003c\/span\u003e \u003cspan class=\u0022nn\u0022\u003erandom\u003c\/span\u003e \u003cspan class=\u0022kn\u0022\u003eimport\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003eRandom\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022kn\u0022\u003efrom\u003c\/span\u003e \u003cspan class=\u0022nn\u0022\u003eflag\u003c\/span\u003e \u003cspan class=\u0022kn\u0022\u003eimport\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003eFLAG\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022kn\u0022\u003eimport\u003c\/span\u003e \u003cspan class=\u0022nn\u0022\u003eos\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003er1\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003eRandom\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e()\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003er1\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eseed\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eos\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eurandom\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003er2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003eRandom\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e()\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003er2\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eseed\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eos\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eurandom\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Dual Mersenne Twister Deterministic Random Bit Generator\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003enum_words\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003eint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022nb\u0022\u003einput\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;n=\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022k\u0022\u003eif\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003enum_words\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u0026gt;\u003c\/span\u003e \u003cspan class=\u0022mi\u0022\u003e100000\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e:\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Network bandwidth doesnt grow on trees!\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003eexit\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e1\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022n\u0022\u003eL\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022p\u0022\u003e[]\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022k\u0022\u003efor\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003ei\u003c\/span\u003e \u003cspan class=\u0022ow\u0022\u003ein\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003erange\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003enum_words\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e):\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003ev1\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003er1\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003egetrandbits\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003er2\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003egetrandbits\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022c1\u0022\u003e# break symmetry by rotating v2\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003eL\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eappend\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e((\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003ev1\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u002b\u003c\/span\u003e \u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e^\u003c\/span\u003e \u003cspan class=\u0022p\u0022\u003e((\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u0026gt;\u0026gt;\u003c\/span\u003e \u003cspan class=\u0022mi\u0022\u003e1\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e|\u003c\/span\u003e \u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u0026amp;\u003c\/span\u003e \u003cspan class=\u0022mi\u0022\u003e1\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u0026lt;\u0026lt;\u003c\/span\u003e \u003cspan class=\u0022mi\u0022\u003e31\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)))\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e\u0026amp;\u003c\/span\u003e \u003cspan class=\u0022mh\u0022\u003e0xffffffff\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;L=\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e\u002b\u003c\/span\u003e\u003cspan class=\u0022nb\u0022\u003estr\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003eL\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Recover the states of r1 and r2 to get the flag.\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Enter the next 624 outputs of r1:\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022k\u0022\u003efor\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003ei\u003c\/span\u003e \u003cspan class=\u0022ow\u0022\u003ein\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003erange\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e624\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e):\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003ev1\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003eint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022nb\u0022\u003einput\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;v1=\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022k\u0022\u003eif\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003ev1\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e!=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003er1\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003egetrandbits\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e):\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e        \u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Incorrect guess\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e        \u003cspan class=\u0022n\u0022\u003eexit\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e1\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Now enter the next 624 outputs of r2:\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022k\u0022\u003efor\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003ei\u003c\/span\u003e \u003cspan class=\u0022ow\u0022\u003ein\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003erange\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e624\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e):\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e=\u003c\/span\u003e \u003cspan class=\u0022nb\u0022\u003eint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022nb\u0022\u003einput\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;v2=\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e))\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e    \u003cspan class=\u0022k\u0022\u003eif\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003ev2\u003c\/span\u003e \u003cspan class=\u0022o\u0022\u003e!=\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003er2\u003c\/span\u003e\u003cspan class=\u0022o\u0022\u003e.\u003c\/span\u003e\u003cspan class=\u0022n\u0022\u003egetrandbits\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e32\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e):\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e        \u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Incorrect guess\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e        \u003cspan class=\u0022n\u0022\u003eexit\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022mi\u0022\u003e1\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003cspan class=\u0022line\u0022\u003e\u003cspan class=\u0022cl\u0022\u003e\u003cspan class=\u0022nb\u0022\u003eprint\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e(\u003c\/span\u003e\u003cspan class=\u0022s2\u0022\u003e\u0026#34;Congratulations, here is the flag:\u0026#34;\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e,\u003c\/span\u003e \u003cspan class=\u0022n\u0022\u003eFLAG\u003c\/span\u003e\u003cspan class=\u0022p\u0022\u003e)\u003c\/span\u003e\n\u003c\/span\u003e\u003c\/span\u003e\u003c\/code\u003e\u003c\/pre\u003e\u003c\/div\u003e\u003c\/details\u003e\n\n\u003cp\u003eThe core of the challenge involves two independent instances of Python\u0026rsquo;s \u003ccode\u003eRandom\u003c\/code\u003e, which we can refer to as \u003ccode\u003er1\u003c\/code\u003e and \u003ccode\u003er2\u003c\/code\u003e.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/etynso.github.io\/posts\/l3akctf2025-dual-mt-drbg\/","author":{"@type":"Person","name":"Etynso"},"copyrightYear":"2025","dateCreated":"2025-07-21T00:00:00\u002b00:00","datePublished":"2025-07-21T00:00:00\u002b00:00","dateModified":"2025-07-21T00:00:00\u002b00:00","keywords":["ctf","crypto","MT19937","linear algebra"],"mainEntityOfPage":"true","wordCount":"3511"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">Home</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Posts title=Posts><p class="text-base font-medium">Posts</p></a><a href=/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-base font-medium">Tags</p></a><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title=About><p class="text-base font-medium">About</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Posts title=Posts><p class="text-bg font-bg">Posts</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-bg font-bg">Tags</p></a></li><li class=mt-1><a href=/about/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=About title=About><p class="text-bg font-bg">About</p></a></li></ul></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/posts/l3akctf2025-dual-mt-drbg/feature-l3ak_hu_89ae8bd880666a9e.png alt="l3akctf2025 — Dual MT DRBG" loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url=/posts/l3akctf2025-dual-mt-drbg/feature-l3ak_hu_89ae8bd880666a9e.png></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Home</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/l3akctf2025-dual-mt-drbg/>l3akctf2025 — Dual MT DRBG</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">l3akctf2025 — Dual MT DRBG</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-07-21T00:00:00+00:00>21 July 2025</time><span class="px-2 text-primary-500">&#183;</span><span>3511 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">17 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt=Etynso src=/b39b5997fa7a6847c18ff2db782e38cc_2842435296422576336_hu_6b4ecfe33ece6e18.png data-zoom-src=/b39b5997fa7a6847c18ff2db782e38cc_2842435296422576336.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Etynso</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Write-ups, notes, and other stuffs.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://discordapp.com/users/227017299939426304 target=_blank aria-label=Discordapp title=Discordapp rel="me noopener noreferrer"><span class="inline-block align-text-bottom"></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#source-code>Source Code:</a></li><li><a href=#initial-thoughts>Initial Thoughts</a></li><li><a href=#the-linearity-of-mt19937>The Linearity of MT19937</a><ul><li><a href=#what-does-linear-even-mean>What does &ldquo;linear&rdquo; even mean?</a></li><li><a href=#how-do-we-know-mt19937-is-linear>How do we know MT19937 is linear?</a></li><li><a href=#how-can-we-model-it-using-linear-algebra>How can we model it using linear algebra?</a></li></ul></li><li><a href=#state-recovery>State Recovery</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#source-code>Source Code:</a></li><li><a href=#initial-thoughts>Initial Thoughts</a></li><li><a href=#the-linearity-of-mt19937>The Linearity of MT19937</a><ul><li><a href=#what-does-linear-even-mean>What does &ldquo;linear&rdquo; even mean?</a></li><li><a href=#how-do-we-know-mt19937-is-linear>How do we know MT19937 is linear?</a></li><li><a href=#how-can-we-model-it-using-linear-algebra>How can we model it using linear algebra?</a></li></ul></li><li><a href=#state-recovery>State Recovery</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">l3akctf2025 - Dual MT DRBG<div id=l3akctf2025---dual-mt-drbg class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#l3akctf2025---dual-mt-drbg aria-label=Anchor>#</a></span></h1><p>Recently i participated in l3akctf2025, and during the CTF I mainly focused on doing the cryptography challenges. I managed to solve the least-solved challenge in this category, &ldquo;Dual MT DRBG&rdquo;.</p><hr><h2 class="relative group">Source Code:<div id=source-code class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#source-code aria-label=Anchor>#</a></span></h2><details><summary>server.py</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>Random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flag</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>r1</span> <span class=o>=</span> <span class=n>Random</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r1</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r2</span> <span class=o>=</span> <span class=n>Random</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r2</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Dual Mersenne Twister Deterministic Random Bit Generator&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>num_words</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;n=&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>num_words</span> <span class=o>&gt;</span> <span class=mi>100000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Network bandwidth doesnt grow on trees!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>L</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_words</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=n>r1</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=n>r2</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># break symmetry by rotating v2</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>v1</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>^</span> <span class=p>((</span><span class=n>v2</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>v2</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>31</span><span class=p>)))</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;L=&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>L</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Recover the states of r1 and r2 to get the flag.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Enter the next 624 outputs of r1:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;v1=&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v1</span> <span class=o>!=</span> <span class=n>r1</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Incorrect guess&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Now enter the next 624 outputs of r2:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;v2=&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>v2</span> <span class=o>!=</span> <span class=n>r2</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Incorrect guess&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Congratulations, here is the flag:&#34;</span><span class=p>,</span> <span class=n>FLAG</span><span class=p>)</span>
</span></span></code></pre></div></details><p>The core of the challenge involves two independent instances of Python&rsquo;s <code>Random</code>, which we can refer to as <code>r1</code> and <code>r2</code>.</p><p>The server provides us with a sequence of outputs. for each step, it generates an integer <code>a_i</code> from <code>r1</code> and another integer <code>b_i</code> from <code>r2</code>. These are then combined using the following formula to produce the output <code>o_i</code> that we receive:</p><p>$$ o_i = (a_i + (b_i \oplus \text{ROR}(b_i, 1))) \pmod{2^{32}} $$</p><p>Where:</p><ul><li><code>a_i</code> is the i-th output of <code>r1</code>.</li><li><code>b_i</code> is the i-th output of <code>r2</code>.</li><li><code>\oplus</code> denotes the bitwise XOR operation.</li><li><code>\text{ROR}(b_i, 1)</code> represents a <strong>32-bit circular right shift</strong> of <code>b_i</code> by one position. The expression <code>(b_i >> 1) | (b_i & 1) &lt;&lt; 31</code> in the source code is a common Python implementation of this operation.</li></ul><p>We can query the server for up to 99,999 of these consecutive <code>o_i</code> values.</p><p>Given this stream of <code>o_i</code> values, our task is to predict the next 624 outputs from <code>r1</code> and <code>r2</code>.</p><h2 class="relative group">Initial Thoughts<div id=initial-thoughts class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#initial-thoughts aria-label=Anchor>#</a></span></h2><p>This challenge actually seems rather straightforward to me, since Python&rsquo;s <code>random</code> under the hood uses MT19937, which is a linear PRNG. The challenge becomes how to actually get equations from the output, considering 32-bit integer addition is not linear over GF(2)</p><blockquote><p>Linear here means linear over the finite field GF(2). For the rest of this write-up, &ldquo;addition&rdquo; refers to the bitwise XOR operation, and &ldquo;multiplication&rdquo; refers to standard integer multiplication, unless stated otherwise.</p></blockquote><h2 class="relative group">The Linearity of MT19937<div id=the-linearity-of-mt19937 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-linearity-of-mt19937 aria-label=Anchor>#</a></span></h2><p>Okay, but before going into the solver, I will first cover these points:</p><ol><li>What does &ldquo;linear&rdquo; even mean?</li><li>How do we know MT19937 is linear?</li><li>How can we model it using linear algebra?</li></ol><hr><h3 class="relative group">What does &ldquo;linear&rdquo; even mean?<div id=what-does-linear-even-mean class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#what-does-linear-even-mean aria-label=Anchor>#</a></span></h3><p>For this write-up, I will be referring to and using the Python MT19937 implementation from this GitHub repository: <a href=https://github.com/tliston/mt19937 target=_blank>tliston/mt19937</a>.</p><p>And for the rest of this writeup we will be mostly working with the &lsquo;state&rsquo; which refers to the internal 624 * 32 bit state of the MT, not the output of the MT.</p><p>The concept of linearity is easy enough: a transformation <code>T</code> is linear if <code>T(a + b) = T(a) + T(b)</code> for all <code>a</code> and <code>b</code>. One nice thing about linear transformations is that they can be represented as matrices. Working with matrices is desirable because we can easily add, compose, or inverse them, among many other things. Another key property to note is that a composition of linear transformations is also linear.</p><p>In the context of a PRNG, when we say it is &ldquo;linear,&rdquo; we mean that its outputs are generated via a linear transformation applied to its internal state.</p><h3 class="relative group">How do we know MT19937 is linear?<div id=how-do-we-know-mt19937-is-linear class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#how-do-we-know-mt19937-is-linear aria-label=Anchor>#</a></span></h3><p>Well, we could just test it by generating a random state and verifying if <code>T(a + b) = T(a) + T(b)</code>. This can be confirmed with the following Python code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mt19937</span> <span class=kn>import</span> <span class=n>mt19937</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>trange</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>correct</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>10000</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>s1</span> <span class=o>=</span> <span class=p>[</span><span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s2</span> <span class=o>=</span> <span class=p>[</span><span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>s3</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r1</span><span class=p>,</span> <span class=n>r2</span><span class=p>,</span> <span class=n>r3</span> <span class=o>=</span> <span class=n>mt19937</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>mt19937</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>mt19937</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=n>s1</span>
</span></span><span class=line><span class=cl>    <span class=n>r2</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=n>s2</span>
</span></span><span class=line><span class=cl>    <span class=n>r3</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=n>s3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>r1</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span> <span class=o>^</span> <span class=n>r2</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span> <span class=o>!=</span> <span class=n>r3</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>correct</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>correct</span><span class=p>)</span>
</span></span></code></pre></div><p>Another way of looking at it is by examining the transformations themselves. In the MT19937 algorithm, there are two core transformations: the <strong>twist</strong> (for state transition) and the <strong>temper</strong> (part of <code>extract_number</code> in the example code). Both of these are composed of only XORs and bitwise shift instructions, which are linear operations over GF(2). Since the composition of linear operations is also linear, we can conclude that the entire process is linear.</p><h3 class="relative group">How can we model it using linear algebra?<div id=how-can-we-model-it-using-linear-algebra class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#how-can-we-model-it-using-linear-algebra aria-label=Anchor>#</a></span></h3><p>Now that all that is done, how do we transform the bitwise mess into linear algebra? The way to do that is by first modeling each bitwise transformation as a matrix multiplication over GF(2), and then composing them by multiplying their corresponding matrices.</p><p>This process is modeled as such in SageMath, using vectors and matrices over GF(2). If you&rsquo;re confused on why the shift matrices is as it is, i advise you to print them out and do the matrix multiplication in your head, it should make sense.</p><details><summary>bitwise_sage.py</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=n>GF</span><span class=p>,</span> <span class=n>vector</span><span class=p>,</span> <span class=n>Matrix</span><span class=p>,</span> <span class=n>identity_matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>F</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>int_to_vec</span><span class=p>(</span><span class=n>n</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>num_bits</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Convert an integer to a GF(2) vector representation with optional bit width.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num_bits</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>num_bits</span> <span class=o>=</span> <span class=n>n</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=ow>or</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>bits</span> <span class=o>=</span> <span class=p>[(</span><span class=n>n</span> <span class=o>&gt;&gt;</span> <span class=n>i</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_bits</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>vector</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>bits</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vec_to_int</span><span class=p>(</span><span class=n>v</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Convert a GF(2) vector back to an integer.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>sum</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>bits</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Bitwise XOR (^) of two GF(2) vectors.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>v1</span> <span class=o>+</span> <span class=n>v2</span>  <span class=c1># In GF(2), addition is the same as XOR</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>left_shift_matrix</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>shift_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generate the transformation matrix for a bitwise left shift operation by shift_amount.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>shift_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span> <span class=o>+</span> <span class=n>shift_amount</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>right_shift_matrix</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>shift_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generate the transformation matrix for a bitwise right shift operation by shift_amount with truncation.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>shift_amount</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>M</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span> <span class=o>-</span> <span class=n>shift_amount</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>M</span>
</span></span></code></pre></div></details><p>Okay, that&rsquo;s all good for the <code>temper</code> part, but what about the <code>twist</code>? Well, you probably could come up with the matrix by hand, but I&rsquo;m too lazy to do that. Luckily, there&rsquo;s another way to do it using what I like to call the <strong>bit contribution</strong> concept.</p><p>The MT19937 internal state consists of 624 32-bit numbers, so we can model the entire state as a single vector of <code>624 * 32 = 19968</code> bits. When we multiply a vector by a matrix in GF(2), we can think of the columns of the matrix as the &ldquo;contribution&rdquo; of each input bit to the final output vector. For example, for a matrix <code>M</code>, the element at row 7, column 10 represents the contribution of the 10th input bit to the 7th output bit.</p><p>To formalize this, let <strong>v</strong> be the input state vector, <strong>M</strong> be the linear transformation (twist) matrix, and <strong>w</strong> be the resulting state vector. The operation is simply <strong>w = Mv</strong>.</p><p>To find a specific column of <strong>M</strong>, say the j-th column, we can feed the transformation function a standard basis vector <strong>ej</strong>. This is a vector that has only the j-th bit set to 1, and all other bits set to 0. The output of this operation will be the j-th column of the matrix <strong>M</strong>:</p><p>$$\text{column}_j(M) = M \cdot e_j = M \cdot \begin{pmatrix} 0 \ \vdots \ 1 \ \vdots \ 0 \end{pmatrix} \leftarrow \text{j-th position}$$</p><p>The problem we&rsquo;re facing is that we have a function that performs the transformation, but we want to model it as a matrix. We can do exactly what the math above describes: for each bit position, we create a vector with only that single bit active and transform it. The resulting vector is the &ldquo;bit contribution&rdquo; for that position, which gives us one column of the transformation matrix. By repeating this for every possible bit index (from 0 to 19967), we can recover the entire transformation matrix.</p><p>This is done using this C code:</p><details><summary>twist.c</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// MT19937 Constants
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define W 32
</span></span></span><span class=line><span class=cl><span class=cp>#define N 624
</span></span></span><span class=line><span class=cl><span class=cp>#define M 397
</span></span></span><span class=line><span class=cl><span class=cp>#define R 31
</span></span></span><span class=line><span class=cl><span class=cp>#define A 0x9908B0DF
</span></span></span><span class=line><span class=cl><span class=cp>#define UPPER_MASK 0x80000000
</span></span></span><span class=line><span class=cl><span class=cp>#define LOWER_MASK 0x7FFFFFFF
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define N_BITS (N * W) </span><span class=c1>// 19968
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>bitwise_twist</span><span class=p>(</span><span class=kt>uint32_t</span> <span class=n>mt</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>mt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=n>UPPER_MASK</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>mt</span><span class=p>[(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>N</span><span class=p>]</span> <span class=o>&amp;</span> <span class=n>LOWER_MASK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>xA</span> <span class=o>=</span> <span class=n>x</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>x</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>xA</span> <span class=o>^=</span> <span class=n>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>mt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>mt</span><span class=p>[(</span><span class=n>i</span> <span class=o>+</span> <span class=n>M</span><span class=p>)</span> <span class=o>%</span> <span class=n>N</span><span class=p>]</span> <span class=o>^</span> <span class=n>xA</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>bitvec_to_numbers</span><span class=p>(</span><span class=k>const</span> <span class=kt>uint8_t</span> <span class=n>bitvec</span><span class=p>[],</span> <span class=kt>uint32_t</span> <span class=n>numbers</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>numbers</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>W</span><span class=p>;</span> <span class=o>++</span><span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>bitvec</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>W</span> <span class=o>+</span> <span class=n>k</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>numbers</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1UL</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>W</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>k</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>numbers_to_bitvec</span><span class=p>(</span><span class=k>const</span> <span class=kt>uint32_t</span> <span class=n>numbers</span><span class=p>[],</span> <span class=kt>uint8_t</span> <span class=n>bitvec</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>W</span><span class=p>;</span> <span class=o>++</span><span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>bitvec</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=n>W</span> <span class=o>+</span> <span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>numbers</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=n>W</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>k</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Starting empirical recovery of the %dx%d MT19937 twist matrix in C.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;This will be significantly faster than Python...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>size_t</span> <span class=n>packed_row_size</span> <span class=o>=</span> <span class=n>N_BITS</span> <span class=o>/</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>size_t</span> <span class=n>matrix_size</span> <span class=o>=</span> <span class=n>N_BITS</span> <span class=o>*</span> <span class=n>packed_row_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>T</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint8_t</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=n>matrix_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>T</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to allocate memory for matrix T&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>T</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>matrix_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>current_col</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint8_t</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=n>N_BITS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>current_col</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to allocate memory for column vector&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>temp_mt_state</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// --- Main Recovery Loop ---
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>N_BITS</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>memset</span><span class=p>(</span><span class=n>current_col</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>current_col</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>bitvec_to_numbers</span><span class=p>(</span><span class=n>current_col</span><span class=p>,</span> <span class=n>temp_mt_state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>bitwise_twist</span><span class=p>(</span><span class=n>temp_mt_state</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>numbers_to_bitvec</span><span class=p>(</span><span class=n>temp_mt_state</span><span class=p>,</span> <span class=n>current_col</span><span class=p>);</span> <span class=c1>// `current_col` now holds the output vector
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// Place this output column into the j-th column of the packed matrix T.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N_BITS</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>current_col</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Calculate the position in the packed array for T[i][j]
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=kt>size_t</span> <span class=n>byte_index</span> <span class=o>=</span> <span class=p>(</span><span class=kt>size_t</span><span class=p>)</span><span class=n>i</span> <span class=o>*</span> <span class=n>packed_row_size</span> <span class=o>+</span> <span class=p>(</span><span class=n>j</span> <span class=o>/</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kt>uint8_t</span> <span class=n>bit_mask</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>j</span> <span class=o>%</span> <span class=mi>8</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=n>T</span><span class=p>[</span><span class=n>byte_index</span><span class=p>]</span> <span class=o>|=</span> <span class=n>bit_mask</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>500</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>double</span> <span class=n>progress</span> <span class=o>=</span> <span class=p>(</span><span class=kt>double</span><span class=p>)(</span><span class=n>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>N_BITS</span> <span class=o>*</span> <span class=mf>100.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Progress: %d / %d columns recovered (%.2f%%)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>,</span> <span class=n>progress</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Matrix recovery complete. Saving to &#39;matrix.txt&#39;...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// --- Save Matrix to File ---
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>FILE</span> <span class=o>*</span><span class=n>fp</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;matrix.txt&#34;</span><span class=p>,</span> <span class=s>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>fp</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to open output file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>current_col</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N_BITS</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>N_BITS</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>size_t</span> <span class=n>byte_index</span> <span class=o>=</span> <span class=p>(</span><span class=kt>size_t</span><span class=p>)</span><span class=n>i</span> <span class=o>*</span> <span class=n>packed_row_size</span> <span class=o>+</span> <span class=p>(</span><span class=n>j</span> <span class=o>/</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kt>uint8_t</span> <span class=n>bit_mask</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>j</span> <span class=o>%</span> <span class=mi>8</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=nf>fputc</span><span class=p>((</span><span class=n>T</span><span class=p>[</span><span class=n>byte_index</span><span class=p>]</span> <span class=o>&amp;</span> <span class=n>bit_mask</span><span class=p>)</span> <span class=o>?</span> <span class=sc>&#39;1&#39;</span> <span class=o>:</span> <span class=sc>&#39;0&#39;</span><span class=p>,</span> <span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>fputc</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>,</span> <span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>fclose</span><span class=p>(</span><span class=n>fp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>free</span><span class=p>(</span><span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>free</span><span class=p>(</span><span class=n>current_col</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Done. The matrix has been saved to &#39;matrix.txt&#39;.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></details><p>Finally, with the matrices for both the <code>temper</code> and <code>twist</code> operations recovered, we can create our own MT19937 implementation that works entirely through matrix multiplication.</p><details><summary>Matrix Mulitiplication MT19937</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bitwise_sage</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>tqdm</span><span class=p>,</span> <span class=n>trange</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>N_BITS</span> <span class=o>=</span> <span class=mi>19968</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>,</span> <span class=n>N_BITS</span><span class=p>,</span> <span class=n>sparse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;../matrix.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>tqdm</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=n>N_BITS</span><span class=p>,</span> <span class=n>desc</span><span class=o>=</span><span class=s2>&#34;Processing Rows&#34;</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&#34; rows&#34;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>char</span> <span class=o>==</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>T</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BIT_SIZE</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>symbolic_mt19937</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span><span class=p>,</span> <span class=n>d</span> <span class=o>=</span> <span class=mi>11</span><span class=p>,</span> <span class=mh>0xFFFFFFFF</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>7</span><span class=p>,</span> <span class=mh>0x9D2C5680</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=p>,</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>15</span><span class=p>,</span> <span class=mh>0xEFC60000</span>
</span></span><span class=line><span class=cl>    <span class=n>l</span> <span class=o>=</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=mi>624</span> <span class=o>*</span> <span class=n>BIT_SIZE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>my_int32</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>(</span><span class=n>x</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>BIT_SIZE</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>m</span> <span class=o>=</span> <span class=mi>397</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=mh>0x9908B0DF</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lower_mask</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>r</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upper_mask</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>my_int32</span><span class=p>(</span><span class=o>~</span><span class=bp>self</span><span class=o>.</span><span class=n>lower_mask</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lower_mask</span> <span class=o>=</span> <span class=n>int_to_vec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lower_mask</span><span class=p>,</span> <span class=n>BIT_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>upper_mask</span> <span class=o>=</span> <span class=n>int_to_vec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>upper_mask</span><span class=p>,</span> <span class=n>BIT_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>temper_matrix</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>untemper_matrix</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>xa_matrix</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>is_matrix</span> <span class=o>=</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=s2>&#34;ncols&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_temper_matrix</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>temper_matrix</span> <span class=o>!=</span> <span class=kc>None</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>temper_matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>mat</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>bitwise_identity_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>),</span> <span class=n>and_transformation_matrix</span><span class=p>(</span><span class=n>int_to_vec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>d</span><span class=p>,</span> <span class=n>BIT_SIZE</span><span class=p>))</span> <span class=o>*</span> <span class=n>right_shift_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>u</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>mat</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>bitwise_identity_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>),</span> <span class=n>and_transformation_matrix</span><span class=p>(</span><span class=n>int_to_vec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>,</span> <span class=n>BIT_SIZE</span><span class=p>))</span> <span class=o>*</span> <span class=n>left_shift_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>s</span><span class=p>))</span> <span class=o>*</span> <span class=n>mat</span>
</span></span><span class=line><span class=cl>        <span class=n>mat</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>bitwise_identity_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>),</span> <span class=n>and_transformation_matrix</span><span class=p>(</span><span class=n>int_to_vec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>c</span><span class=p>,</span> <span class=n>BIT_SIZE</span><span class=p>))</span> <span class=o>*</span> <span class=n>left_shift_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>t</span><span class=p>))</span> <span class=o>*</span> <span class=n>mat</span>
</span></span><span class=line><span class=cl>        <span class=n>mat</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>bitwise_identity_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>),</span> <span class=n>right_shift_matrix</span><span class=p>(</span><span class=n>BIT_SIZE</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>l</span><span class=p>))</span> <span class=o>*</span> <span class=n>mat</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>temper_matrix</span> <span class=o>=</span> <span class=n>mat</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>mat</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_untemper_matrix</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>untemper_matrix</span> <span class=o>!=</span> <span class=kc>None</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>untemper_matrix</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>untemper_matrix</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span><span class=o>.</span><span class=n>inverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_untemper_matrix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>temper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>V</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>V</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>untemper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>V</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_untemper_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>V</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_number</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>twist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>vector</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=o>+</span> <span class=mi>32</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>index</span> <span class=o>+=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>vec_to_int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>twist</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=n>T</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>twist_long</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>624</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>bit_index</span> <span class=o>=</span> <span class=n>i</span> <span class=o>*</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>            <span class=n>mdexed</span> <span class=o>=</span> <span class=p>(</span><span class=n>bit_index</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>m</span> <span class=o>*</span> <span class=n>BIT_SIZE</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>            <span class=n>bitdex</span> <span class=o>=</span> <span class=p>(</span><span class=n>bit_index</span> <span class=o>+</span> <span class=mi>33</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>n</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_matrix</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=o>.</span><span class=n>matrix_from_columns</span><span class=p>([</span><span class=n>bit_index</span><span class=p>])</span><span class=o>.</span><span class=n>augment</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=o>.</span><span class=n>matrix_from_columns</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>bitdex</span><span class=p>,</span> <span class=n>bitdex</span> <span class=o>+</span> <span class=mi>31</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>                <span class=n>xA</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>xA_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>x</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>                <span class=n>xA</span> <span class=o>=</span> <span class=n>xA</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[:,</span> <span class=n>bit_index</span><span class=p>:</span><span class=n>bit_index</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[:,</span> <span class=n>mdexed</span> <span class=p>:</span> <span class=n>mdexed</span> <span class=o>+</span> <span class=mi>32</span><span class=p>]</span> <span class=o>+</span> <span class=n>xA</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[</span><span class=n>bit_index</span><span class=p>:</span><span class=n>bit_index</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[</span><span class=n>bitdex</span> <span class=p>:</span> <span class=n>bitdex</span> <span class=o>+</span> <span class=mi>31</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>xA</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>xA_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[</span><span class=n>bit_index</span><span class=p>:</span><span class=n>bit_index</span> <span class=o>+</span> <span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=p>[</span><span class=n>mdexed</span> <span class=p>:</span> <span class=n>mdexed</span> <span class=o>+</span> <span class=mi>32</span><span class=p>]</span> <span class=o>+</span> <span class=n>xA</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_matrix</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>MT</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>MT</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xA_matrix</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>xa_matrix</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>xa_matrix</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>transformation_matrix</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=mi>31</span> <span class=o>-</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>xA</span> <span class=o>=</span> <span class=n>x</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>x</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>xA</span> <span class=o>=</span> <span class=n>xA</span> <span class=o>^</span> <span class=bp>self</span><span class=o>.</span><span class=n>a</span>
</span></span><span class=line><span class=cl>                <span class=n>transformation_matrix</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>int_to_vec</span><span class=p>(</span><span class=n>xA</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>xa_matrix</span> <span class=o>=</span> <span class=n>transformation_matrix</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>xA_matrix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>numbers_to_bitvec</span><span class=p>(</span><span class=n>numbers</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>int_to_vec</span><span class=p>(</span><span class=n>num</span><span class=p>,</span> <span class=mi>32</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>vector</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>res</span><span class=p>)</span>
</span></span></code></pre></div></details><p>Awesome! Now all that&rsquo;s left is to deal with the tangled output equation:</p><p>$$o_i = (a_i + (b_i \oplus \text{ROR}(b_i, 1))) \pmod{2^{32}}$$</p><p>Let&rsquo;s simplify the inner term by defining <code>b'_i = b_i ⊕ ROR(b_i, 1)</code>. As we&rsquo;ve established, this <code>b'_i</code> term is a linear transformation of <code>b_i</code> and can be represented by a matrix. The equation becomes <code>o_i = (a_i + b'_i) mod 2^32</code>. The real problem is the standard integer addition (<code>+</code>).</p><p>The problem with integer addition essentially is that the value of <code>o_i</code> at the k-th bit isn&rsquo;t just determined by the k-th bit of <code>a_i</code> and <code>b'_i</code>, rather it is also determined by the <strong>carry</strong> from the preceding bit. However, if there is no carry bit, then the operation is essentially just <strong>XOR</strong>. This condition of no carry bit clearly applies for the <strong>LSB</strong> (Least Significant Bit), meaning we can absolutely construct an equation using the output&rsquo;s LSB. However, for reasons I&rsquo;m not 100% sure of either, getting a leak from a single position like this doesn&rsquo;t actually allow you to recover the whole state rather during testing, it only recovered about half of the bits.</p><p>Now, what I came up with is that if the LSB of the output is 1, then we know the carry bit is 0. Because the carry bit is 0, this means that the 2nd LSB is essentially just XOR of the 2nd LSB of <code>a_i</code> and <code>b'_i</code> as well. Then, if the output&rsquo;s 2nd bit is also 1, we know for sure that the carry will also be 0. This chain of logic goes on up to the MSB.</p><p>Basically, consecutive set bits from the LSB guarantee that the bits at those positions are the XORs of the <code>a_i</code> and <code>b'_i</code> bits. This allows us to recover on average 2 bits per output, and since the positions will be somewhat diverse, it does allow us to recover the state completely.</p><h2 class="relative group">State Recovery<div id=state-recovery class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#state-recovery aria-label=Anchor>#</a></span></h2><p>For the state recovery itself, I did it by initializing the symbolic MT with an <strong>identity matrix</strong>. Essentially, this allows us to represent a bit from the MT output as a linear equation in terms of variables <code>bit0</code> to <code>bit19967</code> of the initial state. So in the solver, the columns of our large matrix represent each initial state bit, and the rows represent a linear combination of those bits that equals a known output bit. In other words: <code>row[i] • initial_state = MT_output_bit[i]</code>. This gives us a system of linear equations in variables <code>bit_0</code> to <code>bit_19967</code> for both the MT1 and MT2 states.</p><p>Now, one thing I haven&rsquo;t mentioned is that there are 31 bits from the initial state that are essentially &ldquo;discarded&rdquo; and not used to generate the <em>next</em> state. This is why it&rsquo;s called <strong>MT19937</strong> (since <code>19968 - 31 = 19937</code>). These 31 discarded bits just so happen to be used only in the tempering of the very first 32-bit output. This means the only way we could recover these specific bits is from the very first output of the PRNG, but this is impossible since we can only infer a few bits from that single output.</p><p>This, however, poses no problem since our goal is to <strong>predict future outputs</strong>, not recover the exact initial state. As long as we can recover the 19937 bits that are propagated to the next state, we can predict all future outputs. In total, this requires our system of equations to produce a matrix with a rank of <strong>(19937 * 2)</strong> to solve for both PRNGs.</p><p>Well, there is one problem though: <code>19968 x 19968</code> matrix multiplication is kinda slow. My symbolic <code>twist</code> function takes around 3.5 minutes to run once. Given that we recover about 2 bits per output, it would require around 20,000 outputs, which means we&rsquo;d have to perform the twist operation about 32 times. The total time for twisting alone would be around 108 minutes.</p><p>During the competition, I ran with it anyway because 108 minutes really isn&rsquo;t <em>that</em> long. I was worried that maybe the server had some sort of timeout or rate limit, but whatever i just ran the script, prayed for no timeout and got the flag :)</p><details><summary>solve.py</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bitwise_sage</span> <span class=kn>import</span> <span class=n>F</span><span class=p>,</span> <span class=n>xor</span><span class=p>,</span> <span class=n>right_rot_matrix</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>getrandbits</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>symbolicmt</span> <span class=kn>import</span> <span class=n>symbolic_mt19937</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>trange</span><span class=p>,</span> <span class=n>tqdm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># # Testing Code</span>
</span></span><span class=line><span class=cl><span class=c1># s1 = symbolic_mt19937.numbers_to_bitvec([getrandbits(32) for _ in range(624)])</span>
</span></span><span class=line><span class=cl><span class=c1># s2 = symbolic_mt19937.numbers_to_bitvec([getrandbits(32) for _ in range(624)])</span>
</span></span><span class=line><span class=cl><span class=c1># r1 = symbolic_mt19937(s1.__copy__())</span>
</span></span><span class=line><span class=cl><span class=c1># r2 = symbolic_mt19937(s2.__copy__())</span>
</span></span><span class=line><span class=cl><span class=c1># r1.index = 0</span>
</span></span><span class=line><span class=cl><span class=c1># r2.index = 0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># c1 = []</span>
</span></span><span class=line><span class=cl><span class=c1># c2 = []</span>
</span></span><span class=line><span class=cl><span class=c1># c3 = []</span>
</span></span><span class=line><span class=cl><span class=c1># L = []</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># for i in trange(90000):</span>
</span></span><span class=line><span class=cl><span class=c1>#     v1 = r1.extract_number()</span>
</span></span><span class=line><span class=cl><span class=c1>#     v2 = r2.extract_number()</span>
</span></span><span class=line><span class=cl><span class=c1>#     # break symmetry by rotating v2</span>
</span></span><span class=line><span class=cl><span class=c1>#     L.append((v1 + (v2 ^ ((v2 &gt;&gt; 1) | (v2 &amp; 1) &lt;&lt; 31))) &amp; 0xffffffff)</span>
</span></span><span class=line><span class=cl><span class=c1>#     c1.append(v1)</span>
</span></span><span class=line><span class=cl><span class=c1>#     c2.append(v2)</span>
</span></span><span class=line><span class=cl><span class=c1>#     c3.append(((v2 ^ ((v2 &gt;&gt; 1) | (v2 &amp; 1) &lt;&lt; 31))) &amp; 0xffffffff)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;34.59.96.214&#34;</span><span class=p>,</span> <span class=mi>11002</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>target</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;n=&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;25000&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>target</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;L=&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>L</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>target</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>smt1</span> <span class=o>=</span> <span class=n>symbolic_mt19937</span><span class=p>(</span><span class=n>identity_matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=mi>19968</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>eqmat</span> <span class=o>=</span> <span class=n>matrix</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>19968</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>twist_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># val1 = []</span>
</span></span><span class=line><span class=cl><span class=c1># val2 = []</span>
</span></span><span class=line><span class=cl><span class=c1># val3 = [0]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rottemp</span> <span class=o>=</span> <span class=n>right_rot_matrix</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>smt1</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>tqdm</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>enumerate</span><span class=p>(</span><span class=n>L</span><span class=p>)))</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>624</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Twisting for the </span><span class=si>{</span><span class=n>twist_count</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s2> time&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>smt1</span><span class=o>.</span><span class=n>twist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>twist_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>base_part</span> <span class=o>=</span> <span class=n>smt1</span><span class=o>.</span><span class=n>MT</span><span class=o>.</span><span class=n>submatrix</span><span class=p>(</span><span class=n>i</span> <span class=o>*</span> <span class=mi>32</span> <span class=o>-</span> <span class=n>twist_count</span> <span class=o>*</span> <span class=mi>19968</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>19968</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_part1</span> <span class=o>=</span> <span class=n>smt1</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>base_part</span>
</span></span><span class=line><span class=cl>    <span class=n>current_part2</span> <span class=o>=</span> <span class=n>xor</span><span class=p>(</span><span class=n>smt1</span><span class=o>.</span><span class=n>get_temper_matrix</span><span class=p>()</span> <span class=o>*</span> <span class=n>base_part</span><span class=p>,</span> <span class=n>rottemp</span> <span class=o>*</span> <span class=n>base_part</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># val1.append(vec_to_int(current_part1 * s1))</span>
</span></span><span class=line><span class=cl>    <span class=c1># val2.append(vec_to_int(current_part2 * s2))</span>
</span></span><span class=line><span class=cl>    <span class=c1># val3.append(vector(list(current_part1[31]) + list(current_part2[31])).dot_product(vector(list(s1) + list(s2))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bits</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=nb>bin</span><span class=p>(</span><span class=n>c</span><span class=p>)[</span><span class=mi>2</span><span class=p>:]</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>32</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>bit_pos</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>31</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>eqmat</span> <span class=o>=</span> <span class=n>eqmat</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span><span class=n>vector</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>current_part1</span><span class=p>[</span><span class=n>bit_pos</span><span class=p>])</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>current_part2</span><span class=p>[</span><span class=n>bit_pos</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>bits</span><span class=p>[</span><span class=n>bit_pos</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bits</span><span class=p>[</span><span class=n>bit_pos</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>1000</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>eqmat</span><span class=o>.</span><span class=n>rank</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>eqmat</span><span class=o>.</span><span class=n>rank</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=p>(</span><span class=mi>19937</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>eqech</span> <span class=o>=</span> <span class=n>eqmat</span><span class=o>.</span><span class=n>augment</span><span class=p>(</span><span class=n>vector</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>result</span><span class=p>))</span><span class=o>.</span><span class=n>echelon_form</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- Analyzing the Echelon Form ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>solution_part</span> <span class=o>=</span> <span class=n>eqech</span><span class=o>.</span><span class=n>column</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>eq_part</span> <span class=o>=</span> <span class=n>eqech</span><span class=o>.</span><span class=n>matrix_from_columns</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>eqech</span><span class=o>.</span><span class=n>ncols</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>matrank</span> <span class=o>=</span> <span class=n>eq_part</span><span class=o>.</span><span class=n>rank</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>num_vars</span> <span class=o>=</span> <span class=n>eq_part</span><span class=o>.</span><span class=n>ncols</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>bits_missing</span> <span class=o>=</span> <span class=n>num_vars</span> <span class=o>-</span> <span class=n>matrank</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;System Rank: </span><span class=si>{</span><span class=n>matrank</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Total Variables: </span><span class=si>{</span><span class=n>num_vars</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Undetermined Bits (Degrees of Freedom): </span><span class=si>{</span><span class=n>bits_missing</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pivots</span> <span class=o>=</span> <span class=n>eq_part</span><span class=o>.</span><span class=n>pivots</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>non_pivots</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>num_vars</span><span class=p>))</span> <span class=o>-</span> <span class=nb>set</span><span class=p>(</span><span class=n>pivots</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># We assume the free variables (non-pivots) are all 0</span>
</span></span><span class=line><span class=cl><span class=n>s_recovered_partial</span> <span class=o>=</span> <span class=n>vector</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=n>num_vars</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=n>matrank</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pivot_col</span> <span class=o>=</span> <span class=n>pivots</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>val</span> <span class=o>=</span> <span class=n>solution_part</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>s_recovered_partial</span><span class=p>[</span><span class=n>pivot_col</span><span class=p>]</span> <span class=o>=</span> <span class=n>val</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>--- Verifying the Recovered State ---&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Split the combined solution vector back into two separate state vectors</span>
</span></span><span class=line><span class=cl><span class=n>s1_recovered</span> <span class=o>=</span> <span class=n>s_recovered_partial</span><span class=p>[:</span><span class=mi>19968</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>s2_recovered</span> <span class=o>=</span> <span class=n>s_recovered_partial</span><span class=p>[</span><span class=mi>19968</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create new MT instances from the recovered states</span>
</span></span><span class=line><span class=cl><span class=n>r1_recovered</span> <span class=o>=</span> <span class=n>symbolic_mt19937</span><span class=p>(</span><span class=n>s1_recovered</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r2_recovered</span> <span class=o>=</span> <span class=n>symbolic_mt19937</span><span class=p>(</span><span class=n>s2_recovered</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r1_recovered</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>r2_recovered</span><span class=o>.</span><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Generating outputs from the recovered state...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recovered_outputs1</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>recovered_outputs2</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>test_outputs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r1_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>r2_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>trange</span><span class=p>(</span><span class=mi>25000</span><span class=o>-</span><span class=mi>624</span><span class=p>,</span> <span class=n>desc</span><span class=o>=</span><span class=s2>&#34;Generating from recovered state&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=n>r1_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=n>r2_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>recovered_outputs1</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>v1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recovered_outputs2</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>test_outputs</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>v1</span> <span class=o>+</span> <span class=p>(</span><span class=n>v2</span> <span class=o>^</span> <span class=p>((</span><span class=n>v2</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>v2</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>31</span><span class=p>)))</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>test_outputs</span> <span class=o>==</span> <span class=n>L</span><span class=p>[</span><span class=mi>624</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>SUCCESS!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>FAILURE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;v1=&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>r1_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>())</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>624</span><span class=p>)</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;v2=&#34;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>r2_recovered</span><span class=o>.</span><span class=n>extract_number</span><span class=p>())</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div></details></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/l3akctf2025-dual-mt-drbg/index.md data-oid-likes=likes_posts/l3akctf2025-dual-mt-drbg/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/interesting-unsolved-challs/><span class=leading-6>Unsolved Challs from Local CTFs #1&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-11-17T00:00:00+00:00>17 November 2025</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-24 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Etynso</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://etynso.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>